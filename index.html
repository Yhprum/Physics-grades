<!DOCTYPE html>
<html>
<head>
    <title>Greco the Taco</title> <!-- Darnton Abbey -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <div class="text-center">
            <h1>Physics Grade Calculator</h1>
            <hr>
        </div>
        <div class="col-md-4">
            <h3>Exam Grades</h3>
            <form class="form-horizontal">
              <div class="form-group">
                <label for="test1" class="col-sm-3 control-label">Test 1</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="test1">
                </div>
              </div>
              <div class="form-group">
                <label for="test2" class="col-sm-3 control-label">Test 2</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="test2">
                </div>
              </div>
              <div class="form-group">
                <label for="test3" class="col-sm-3 control-label">Test 3</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="test3">
                </div>
              </div>
              <div class="form-group">
                <label for="test4" class="col-sm-3 control-label">Test 4</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="test4">
                </div>
              </div>
              <div class="form-group">
                <label for="final" class="col-sm-3 control-label">Final</label>
                <div class="col-sm-9">
                  <input type="number" class="form-control" id="final">
                </div>
              </div>
            </form>
            <p>If you haven't taken a test, leave the row blank! Or fill in future scores to see how it changes your grade.
            </p>
        </div>
        <div class="col-md-4">
            <h3>Lab Grades</h3>
            <form class="form-horizontal">
              <div class="form-group">
                <label for="quiz" class="col-sm-5 control-label">Lab Quiz</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="quiz">
                </div>
              </div>
              <div class="form-group">
                <label for="checkpoint" class="col-sm-5 control-label">Lab Checkpoints</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="checkpoint">
                </div>
              </div>
              <div class="form-group">
                <label for="assignment" class="col-sm-5 control-label">Lab Assignments</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="assignment">
                </div>
              </div>
            </form>
            <h3>Extra Credit</h3>
            <form class="form-horizontal">
              <div class="form-group">
                <label for="pre" class="col-sm-5 control-label">Pre-Assessment</label>
                <div class="col-sm-7">
                  <select class="form-control" id="pre">
                    <option>Not Completed</option>
                    <option>Completed</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="post" class="col-sm-5 control-label">Post-Assessment</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="post" placeholder="Estimate grade">
                </div>
              </div>
            </form>
        </div>
        <div class="col-md-4">
            <h3>Bucket Points</h3>
            <form class="form-horizontal">
              <div class="form-group">
                <label for="homework" class="col-sm-5 control-label">Homework</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="homework">
                </div>
              </div>
              <div class="form-group">
                <label for="clicker" class="col-sm-5 control-label">Clickers</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="clicker">
                </div>
              </div>
              <div class="form-group">
                <label for="optional" class="col-sm-5 control-label">Optional</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="optional">
                </div>
              </div>
              <div class="form-group">
                <label for="wiki" class="col-sm-5 control-label">Wiki Resource</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="wiki">
                </div>
              </div>
              <div class="form-group">
                <label for="lecture" class="col-sm-5 control-label">Public Lecture</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="lecture">
                </div>
              </div>
              <div class="form-group">
                <label for="reading" class="col-sm-5 control-label">Reading</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="reading">
                </div>
              </div>
            </form>
        </div>
        <hr style="clear: both">
        <button class="btn btn-default" data-toggle="modal" data-target="#importmodal">Import Grades from Webassign</button>
        <button class="btn btn-default" type="submit" style="float: right" id="calculate">Calculate!</button><br><br>
        <div>
            <table class="table" style="margin: auto; width: auto">
                <tbody>
                    <tr>
                        <td></td>
                        <td>Weight</td>
                        <td>Grade</td>
                    </tr>
                    <tr>
                        <td>Exams</td>
                        <td>45%</td>
                        <td id="examgrade">N/A</td>
                    </tr>
                    <tr>
                        <td>Final</td>
                        <td>25%</td>
                        <td id="finalgrade">N/A</td>
                    </tr>
                    <tr>
                        <td>Lab</td>
                        <td>20%</td>
                        <td id="labgrade">N/A</td>
                    </tr>
                    <tr>
                        <td>Bucket</td>
                        <td>10%</td>
                        <td id="bucketgrade">N/A</td>
                    </tr>
                    <tr>
                        <td>Extra Bucket</td>
                        <td>2%</td>
                        <td id="ecgrade">N/A</td>
                    </tr>
                    <tr>
                        <td>Extra Assessment</td>
                        <td>1%</td>
                        <td id="assessment">N/A</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="text-center">
            <h3><b>Your current grade is <span id="grade">N/A</span>%</b></h3>
            <b><span id="need"></span></b>
        </div>
        <div style="bottom: 1%; position: fixed;">
            <small>Made by Ryan Murphy</small>
        </div>
    </div>
    <div class="modal fade" id="importmodal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Import from Webassign</h4>
          </div>
          <div class="modal-body">
            <p>Directions</p>
            <p style="float: left">
                1. Go to the grades tab of webassign<br>
                2. Copy everything (ctrl-a then ctrl-c)<br>
                3. Paste into 1st textbox<br>
            </p>
            <p style="float: right">
                4. Click the test grade category<br>
                5. Copy everything (ctrl-a then ctrl-c)<br>
                6. Paste into 2nd textbox<br>
            </p>
            <textarea id="general" rows="5" cols="78" placeholder="WebAssign&#13;&#10;Welcome, gburdell3@gatech (sign out)"></textarea>
            <textarea id="tests" rows="5" cols="78" placeholder="GradeBook&#13;&#10;PHYS 2212, section NPQ&#13;&#10;&#13;&#10;Test Average for George Burdell"></textarea>
            <p>7. Dont forget to fill out the extra credit if you did the assessments!</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="import">Import!</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#import').on("click", function() {
                let general = document.getElementById('general').value;
                let tests = document.getElementById('tests').value;

                if (general) {
                    let hw = general.match(/Homework.*\s*(.*)/) || 0;
                    let quiz = general.match(/Quiz.*\s*(.*)/) || 0;
                    let lab = general.match(/Lab.*\s*(.*)/) || 0;
                    let checkpoints = general.match(/Lab Checkpoints.*\s*(.*)/) || 0;
                    let clickers = general.match(/In Class.*\s*(.*)/) || 0;
                    let optional = general.match(/Optional.*\s*(.*)/) || 0;
                    let reading = general.match(/Reading.*\s*(.*)/) || 0;
                    let lectures = general.match(/Public Lectures.*\s*(.*)/) || 0;
                    let wiki = general.match(/Wiki.*\s*(.*)/) || 0;
                    let final = general.match(/Exam.*\s*(.*)/) || 0;

                    document.getElementById('quiz').value = quiz[1] || 0;
                    document.getElementById('checkpoint').value = checkpoints[1] || 0;
                    document.getElementById('assignment').value = lab[1] || 0;

                    document.getElementById('homework').value = hw[1] || 0;
                    document.getElementById('clicker').value = clickers[1] || 0;
                    document.getElementById('optional').value = optional[1] || 0;
                    document.getElementById('wiki').value = wiki[1] || 0;
                    document.getElementById('lecture').value = lectures[1] || 0;
                    document.getElementById('reading').value = reading[1] || 0;

                    document.getElementById('final').value = final[1] || document.getElementById('final').value;
                }
                if (tests) {
                    let test1 = tests.match(/Test 1.*?x 100 = (\S+)/) || 0;
                    let test2 = tests.match(/Test 2.*?x 100 = (\S+)/) || 0;
                    let test3 = tests.match(/Test 3.*?x 100 = (\S+)/) || 0;
                    let test4 = tests.match(/Test 4.*?x 100 = (\S+)/) || 0;

                    document.getElementById('test1').value = test1[1] || document.getElementById('test1').value;
                    document.getElementById('test2').value = test2[1] || document.getElementById('test1').value;
                    document.getElementById('test3').value = test3[1] || document.getElementById('test1').value;
                    document.getElementById('test4').value = test4[1] || document.getElementById('test1').value;
                }
                
                
                $("#importmodal").modal('hide');
            });
            $('#calculate').on('click', function() {
                var tests = []
                if (document.getElementById('test1').value) {
                    tests.push(document.getElementById('test1').value)
                }
                if (document.getElementById('test2').value) {
                    tests.push(document.getElementById('test2').value)
                }
                if (document.getElementById('test3').value) {
                    tests.push(document.getElementById('test3').value)
                }
                if (document.getElementById('test4').value) {
                    tests.push(document.getElementById('test4').value)
                }
                tests.sort(function(a, b){return b - a});
                let testgrade = 0
                let weights = [.18, .12, .09, .06]
                for(let i = 0; i < tests.length; i++) {
                    testgrade += tests[i] * weights[i];
                }
                if(tests.length == 1) {
                    testgrade = testgrade * 45/18
                } else if (tests.length == 2) {
                    testgrade = testgrade * 45/30
                } else if (tests.length == 3) {
                    testgrade = testgrade * 45/39
                }
                testgrade = testgrade * 100/45

                let quiz = document.getElementById('quiz').value;
                let checkpoints = document.getElementById('checkpoint').value;
                let lab = document.getElementById('assignment').value;
                let labgrade = quiz * .25 + checkpoints * .5 + lab * .25

                let hw = document.getElementById('homework').value;
                let clickers = document.getElementById('clicker').value;
                let optional = document.getElementById('optional').value;
                let wiki = document.getElementById('wiki').value;
                let lectures = document.getElementById('lecture').value;
                let reading = document.getElementById('reading').value;
                let bucketgrade = Math.min(10, (hw*.05 + clickers*.04 + optional*.03 + wiki*.02 + lectures*.01 + reading*.01)) * 10;
                let possible = (hw*.05 + clickers*.04 + optional*.03 + wiki*.02 + lectures*.01 + reading*.01) / 16;
                let extra = Math.max(0, Math.min(5, possible*16 - hw*.05) + hw*.05 - 10)*50

                let assessment = 0
                if ($("#pre").val() == "Completed") {
                    assessment += 25
                }
                if ($("#post").val() != "") {
                    assessment += 25 + $("#post").val() * .5
                }

                document.getElementById('examgrade').innerText = Math.round(testgrade * 100) / 100;
                document.getElementById('labgrade').innerText = Math.round(labgrade * 100) / 100;
                document.getElementById('bucketgrade').innerText = Math.round(bucketgrade * 100) / 100;
                document.getElementById('ecgrade').innerText = Math.round(extra * 100) / 100;
                document.getElementById('assessment').innerText = Math.round(assessment * 100) / 100;

                let final = document.getElementById('final').value;
                var fgrade = 0;
                if(final) {
                    document.getElementById('finalgrade').innerText = final;
                    fgrade = .25*final + .45*testgrade + .2*labgrade + .1*bucketgrade + .02*extra + .01 * assessment;
                    let t = "Congration. You done it";
                    document.getElementById('need').innerText = t;
                } else {
                    fgrade = (.45*testgrade + .2*labgrade + .1*bucketgrade + .02*extra) * 100/75  + .01 * assessment;
                    let needA = (90-.75*fgrade)/.25
                    needA = Math.round(needA * 100) / 100;
                    let needB = (80-.75*fgrade)/.25
                    needB = Math.round(needB * 100) / 100;
                    let needC = (70-.75*fgrade)/.25
                    needC = Math.round(needC * 100) / 100;
                    let t = 'With your current test average, you need a ' + needA + '% on the final to get an A, ';
                    t += 'a ' + needB + '% on the final to get a B, '
                    t += 'or a ' + needC + '% on the final to get a C'
                    document.getElementById('need').innerText = t;
                }
                document.getElementById('grade').innerText = Math.round(fgrade * 100) / 100;
            });
        });
    </script>
</body>
</html>
